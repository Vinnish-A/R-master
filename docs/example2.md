


# R的基础和特征

## R中的数据结构

R中最基本的数据格式是向量,R中事实上没有单个的数据格式比如字符串、数值,单个是数据实质上都是一维向量。

```r
class("class")
```

```
## [1] "character"
```

```r
class(c("class"))
```

```
## [1] "character"
```

```r
class(c("class1", "class2"))
```

```
## [1] "character"
```

```r
class(1)
```

```
## [1] "numeric"
```

```r
class(c(1))
```

```
## [1] "numeric"
```

向量是同质性的，如果格式不同则强制转格式。


```r
c(1, "class")
```

```
## [1] "1"     "class"
```

列表是特殊的向量（异质性向量）


```r
list(1, "class")
```

```
## [[1]]
## [1] 1
## 
## [[2]]
## [1] "class"
```

```r
list(c(1, 2), "class")
```

```
## [[1]]
## [1] 1 2
## 
## [[2]]
## [1] "class"
```

向量和列表的每一个元素都可以拥有名字,可以通过名字索引，所以不能重名。


```r
vec_exp = c(age = 1, class = "class")
vec_exp[["age"]]
```

```
## [1] "1"
```

注意以下两者的区别


```r
vec_exp[[1]]
```

```
## [1] "1"
```

```r
vec_exp[1]
```

```
## age 
## "1"
```


```r
# 向量中无法使用$
# vec_exp$age
lst_exp = list(age = 1, class = "class")
```

注意以下两者的区别

```r
lst_exp[[1]]
```

```
## [1] 1
```

```r
lst_exp[1]
```

```
## $age
## [1] 1
```

以下三者等价

```r
lst_exp[["age"]] == lst_exp$age
```

```
## [1] TRUE
```

```r
lst_exp$age
```

```
## [1] 1
```

```r
lst_exp[1]$age
```

```
## [1] 1
```

使用names调用向量和列表的名字。


```r
names(lst_exp)
```

```
## [1] "age"   "class"
```

dataframe是特殊的列表,列表中每个元素都是等长的向量,dataframe的每一列都是一个向量。


```r
data.frame(list(age = c(1, 2), class = c("class1", "class2")))
```

```
##   age  class
## 1   1 class1
## 2   2 class2
```

```r
data_exp = data.frame(age = c(1, 2), class = c("class1", "class2"))
```

所以基本上可以用操作列表的方法操作dataframe。


```r
var = "age"

data_exp$age
```

```
## [1] 1 2
```

```r
data_exp[["age"]]
```

```
## [1] 1 2
```

```r
data_exp[[var]]
```

```
## [1] 1 2
```

尤其注意以下两者的区别


```r
data_exp[1]
```

```
##   age
## 1   1
## 2   2
```

```r
data_exp[[1]]
```

```
## [1] 1 2
```

dataframe特有的方法是[x, y]行列索引,空格为全选。


```r
data_exp[, 1]
```

```
## [1] 1 2
```

```r
data_exp[1, ]
```

```
##   age  class
## 1   1 class1
```

由于历史问题，下两者属性不同,但是在tidyverse的数据表tibble中这个问题不再。


```r
class(data_exp[1, ])
```

```
## [1] "data.frame"
```

```r
class(data_exp[, 1])
```

```
## [1] "numeric"
```

dataframe的名同列表，但不同的是多了行名属性,行名在tibble中并不常用。


```r
names(data_exp)
```

```
## [1] "age"   "class"
```

```r
rownames(data_exp)
```

```
## [1] "1" "2"
```

## 向量化

向量化是R最典型的特征,不是说别的语言没有。

矩阵运算


```r
c(1, 2) + c(2, 3)
```

```
## [1] 3 5
```

```r
c(1, 2) * c(2, 3)
```

```
## [1] 2 6
```

```r
matrix(1:4, nrow = 2) %*% c(1, 2)
```

```
##      [,1]
## [1,]    7
## [2,]   10
```

除了矩阵乘法，更多是作为泛函。


```r
data_exp %>% 
  apply(2, length)
```

```
##   age class 
##     2     2
```

```r
rep(c(1, 2), c(3, 5))
```

```
## [1] 1 1 1 2 2 2 2 2
```

最常用的tidyr其实就是向量化的一种体现。


```r
data_exp %>% 
  mutate(gender = c("boy", "boy"), 
         location = paste(gender, "of", class))
```

```
##   age  class gender      location
## 1   1 class1    boy boy of class1
## 2   2 class2    boy boy of class2
```

## for循环

r中的for循环并不慢，之所以名声不好，是因为for循环太简单了，容易写出效率不高的冗余代码。


```r
for (i in 1:10) {
  print(i)
}
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10
```

注意这里的{}，其实没有也行,{}的作用是新创建一个空间，就是把一整段代码变成看起来只有一段代码。


```r
for (i in 1:10) print(i)
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10
```

匿名函数就是这个原理，有花括号的地方都可以这么省。


```r
sapply(1:10, function(x) x + 1)
```

```
##  [1]  2  3  4  5  6  7  8  9 10 11
```

```r
if (T) print("TRUE")
```

```
## [1] "TRUE"
```

## for的向量化

```r
result = c()
for (i in 1:ncol(data_exp)) {
  result[i] = length(data_exp[[i]])
}
result
```

```
## [1] 2 2
```

哪些情况用for循环，哪些情况用apply，随你便，但是apply在简单情形可以少写几行代码，而且apply函数簇更容易并行加速，因为apply的操作单位有且只有单个对象。

## 标准化


```r
iris %>%
  select(where(is.numeric)) %>% 
  apply(2, scale)
```

```
##        Sepal.Length Sepal.Width Petal.Length   Petal.Width
##   [1,]  -0.89767388  1.01560199  -1.33575163 -1.3110521482
##   [2,]  -1.13920048 -0.13153881  -1.33575163 -1.3110521482
##   [3,]  -1.38072709  0.32731751  -1.39239929 -1.3110521482
##   [4,]  -1.50149039  0.09788935  -1.27910398 -1.3110521482
##   [5,]  -1.01843718  1.24503015  -1.33575163 -1.3110521482
##   [6,]  -0.53538397  1.93331463  -1.16580868 -1.0486667950
##   [7,]  -1.50149039  0.78617383  -1.33575163 -1.1798594716
##   [8,]  -1.01843718  0.78617383  -1.27910398 -1.3110521482
##   [9,]  -1.74301699 -0.36096697  -1.33575163 -1.3110521482
##  [10,]  -1.13920048  0.09788935  -1.27910398 -1.4422448248
##  [11,]  -0.53538397  1.47445831  -1.27910398 -1.3110521482
##  [12,]  -1.25996379  0.78617383  -1.22245633 -1.3110521482
##  [13,]  -1.25996379 -0.13153881  -1.33575163 -1.4422448248
##  [14,]  -1.86378030 -0.13153881  -1.50569459 -1.4422448248
##  [15,]  -0.05233076  2.16274279  -1.44904694 -1.3110521482
##  [16,]  -0.17309407  3.08045544  -1.27910398 -1.0486667950
##  [17,]  -0.53538397  1.93331463  -1.39239929 -1.0486667950
##  [18,]  -0.89767388  1.01560199  -1.33575163 -1.1798594716
##  [19,]  -0.17309407  1.70388647  -1.16580868 -1.1798594716
##  [20,]  -0.89767388  1.70388647  -1.27910398 -1.1798594716
##  [21,]  -0.53538397  0.78617383  -1.16580868 -1.3110521482
##  [22,]  -0.89767388  1.47445831  -1.27910398 -1.0486667950
##  [23,]  -1.50149039  1.24503015  -1.56234224 -1.3110521482
##  [24,]  -0.89767388  0.55674567  -1.16580868 -0.9174741184
##  [25,]  -1.25996379  0.78617383  -1.05251337 -1.3110521482
##  [26,]  -1.01843718 -0.13153881  -1.22245633 -1.3110521482
##  [27,]  -1.01843718  0.78617383  -1.22245633 -1.0486667950
##  [28,]  -0.77691058  1.01560199  -1.27910398 -1.3110521482
##  [29,]  -0.77691058  0.78617383  -1.33575163 -1.3110521482
##  [30,]  -1.38072709  0.32731751  -1.22245633 -1.3110521482
##  [31,]  -1.25996379  0.09788935  -1.22245633 -1.3110521482
##  [32,]  -0.53538397  0.78617383  -1.27910398 -1.0486667950
##  [33,]  -0.77691058  2.39217095  -1.27910398 -1.4422448248
##  [34,]  -0.41462067  2.62159911  -1.33575163 -1.3110521482
##  [35,]  -1.13920048  0.09788935  -1.27910398 -1.3110521482
##  [36,]  -1.01843718  0.32731751  -1.44904694 -1.3110521482
##  [37,]  -0.41462067  1.01560199  -1.39239929 -1.3110521482
##  [38,]  -1.13920048  1.24503015  -1.33575163 -1.4422448248
##  [39,]  -1.74301699 -0.13153881  -1.39239929 -1.3110521482
##  [40,]  -0.89767388  0.78617383  -1.27910398 -1.3110521482
##  [41,]  -1.01843718  1.01560199  -1.39239929 -1.1798594716
##  [42,]  -1.62225369 -1.73753594  -1.39239929 -1.1798594716
##  [43,]  -1.74301699  0.32731751  -1.39239929 -1.3110521482
##  [44,]  -1.01843718  1.01560199  -1.22245633 -0.7862814418
##  [45,]  -0.89767388  1.70388647  -1.05251337 -1.0486667950
##  [46,]  -1.25996379 -0.13153881  -1.33575163 -1.1798594716
##  [47,]  -0.89767388  1.70388647  -1.22245633 -1.3110521482
##  [48,]  -1.50149039  0.32731751  -1.33575163 -1.3110521482
##  [49,]  -0.65614727  1.47445831  -1.27910398 -1.3110521482
##  [50,]  -1.01843718  0.55674567  -1.33575163 -1.3110521482
##  [51,]   1.39682886  0.32731751   0.53362088  0.2632599711
##  [52,]   0.67224905  0.32731751   0.42032558  0.3944526477
##  [53,]   1.27606556  0.09788935   0.64691619  0.3944526477
##  [54,]  -0.41462067 -1.73753594   0.13708732  0.1320672944
##  [55,]   0.79301235 -0.59039513   0.47697323  0.3944526477
##  [56,]  -0.17309407 -0.59039513   0.42032558  0.1320672944
##  [57,]   0.55148575  0.55674567   0.53362088  0.5256453243
##  [58,]  -1.13920048 -1.50810778  -0.25944625 -0.2615107354
##  [59,]   0.91377565 -0.36096697   0.47697323  0.1320672944
##  [60,]  -0.77691058 -0.81982329   0.08043967  0.2632599711
##  [61,]  -1.01843718 -2.42582042  -0.14615094 -0.2615107354
##  [62,]   0.06843254 -0.13153881   0.25038262  0.3944526477
##  [63,]   0.18919584 -1.96696410   0.13708732 -0.2615107354
##  [64,]   0.30995914 -0.36096697   0.53362088  0.2632599711
##  [65,]  -0.29385737 -0.36096697  -0.08950329  0.1320672944
##  [66,]   1.03453895  0.09788935   0.36367793  0.2632599711
##  [67,]  -0.29385737 -0.13153881   0.42032558  0.3944526477
##  [68,]  -0.05233076 -0.81982329   0.19373497 -0.2615107354
##  [69,]   0.43072244 -1.96696410   0.42032558  0.3944526477
##  [70,]  -0.29385737 -1.27867961   0.08043967 -0.1303180588
##  [71,]   0.06843254  0.32731751   0.59026853  0.7880306775
##  [72,]   0.30995914 -0.59039513   0.13708732  0.1320672944
##  [73,]   0.55148575 -1.27867961   0.64691619  0.3944526477
##  [74,]   0.30995914 -0.59039513   0.53362088  0.0008746178
##  [75,]   0.67224905 -0.36096697   0.30703027  0.1320672944
##  [76,]   0.91377565 -0.13153881   0.36367793  0.2632599711
##  [77,]   1.15530226 -0.59039513   0.59026853  0.2632599711
##  [78,]   1.03453895 -0.13153881   0.70356384  0.6568380009
##  [79,]   0.18919584 -0.36096697   0.42032558  0.3944526477
##  [80,]  -0.17309407 -1.04925145  -0.14615094 -0.2615107354
##  [81,]  -0.41462067 -1.50810778   0.02379201 -0.1303180588
##  [82,]  -0.41462067 -1.50810778  -0.03285564 -0.2615107354
##  [83,]  -0.05233076 -0.81982329   0.08043967  0.0008746178
##  [84,]   0.18919584 -0.81982329   0.76021149  0.5256453243
##  [85,]  -0.53538397 -0.13153881   0.42032558  0.3944526477
##  [86,]   0.18919584  0.78617383   0.42032558  0.5256453243
##  [87,]   1.03453895  0.09788935   0.53362088  0.3944526477
##  [88,]   0.55148575 -1.73753594   0.36367793  0.1320672944
##  [89,]  -0.29385737 -0.13153881   0.19373497  0.1320672944
##  [90,]  -0.41462067 -1.27867961   0.13708732  0.1320672944
##  [91,]  -0.41462067 -1.04925145   0.36367793  0.0008746178
##  [92,]   0.30995914 -0.13153881   0.47697323  0.2632599711
##  [93,]  -0.05233076 -1.04925145   0.13708732  0.0008746178
##  [94,]  -1.01843718 -1.73753594  -0.25944625 -0.2615107354
##  [95,]  -0.29385737 -0.81982329   0.25038262  0.1320672944
##  [96,]  -0.17309407 -0.13153881   0.25038262  0.0008746178
##  [97,]  -0.17309407 -0.36096697   0.25038262  0.1320672944
##  [98,]   0.43072244 -0.36096697   0.30703027  0.1320672944
##  [99,]  -0.89767388 -1.27867961  -0.42938920 -0.1303180588
## [100,]  -0.17309407 -0.59039513   0.19373497  0.1320672944
## [101,]   0.55148575  0.55674567   1.27004036  1.7063794137
## [102,]  -0.05233076 -0.81982329   0.76021149  0.9192233541
## [103,]   1.51759216 -0.13153881   1.21339271  1.1816087073
## [104,]   0.55148575 -0.36096697   1.04344975  0.7880306775
## [105,]   0.79301235 -0.13153881   1.15674505  1.3128013839
## [106,]   2.12140867 -0.13153881   1.60992627  1.1816087073
## [107,]  -1.13920048 -1.27867961   0.42032558  0.6568380009
## [108,]   1.75911877 -0.36096697   1.43998331  0.7880306775
## [109,]   1.03453895 -1.27867961   1.15674505  0.7880306775
## [110,]   1.63835547  1.24503015   1.32668801  1.7063794137
## [111,]   0.79301235  0.32731751   0.76021149  1.0504160307
## [112,]   0.67224905 -0.81982329   0.87350679  0.9192233541
## [113,]   1.15530226 -0.13153881   0.98680210  1.1816087073
## [114,]  -0.17309407 -1.27867961   0.70356384  1.0504160307
## [115,]  -0.05233076 -0.59039513   0.76021149  1.5751867371
## [116,]   0.67224905  0.32731751   0.87350679  1.4439940605
## [117,]   0.79301235 -0.13153881   0.98680210  0.7880306775
## [118,]   2.24217198  1.70388647   1.66657392  1.3128013839
## [119,]   2.24217198 -1.04925145   1.77986923  1.4439940605
## [120,]   0.18919584 -1.96696410   0.70356384  0.3944526477
## [121,]   1.27606556  0.32731751   1.10009740  1.4439940605
## [122,]  -0.29385737 -0.59039513   0.64691619  1.0504160307
## [123,]   2.24217198 -0.59039513   1.66657392  1.0504160307
## [124,]   0.55148575 -0.81982329   0.64691619  0.7880306775
## [125,]   1.03453895  0.55674567   1.10009740  1.1816087073
## [126,]   1.63835547  0.32731751   1.27004036  0.7880306775
## [127,]   0.43072244 -0.59039513   0.59026853  0.7880306775
## [128,]   0.30995914 -0.13153881   0.64691619  0.7880306775
## [129,]   0.67224905 -0.59039513   1.04344975  1.1816087073
## [130,]   1.63835547 -0.13153881   1.15674505  0.5256453243
## [131,]   1.87988207 -0.59039513   1.32668801  0.9192233541
## [132,]   2.48369858  1.70388647   1.49663097  1.0504160307
## [133,]   0.67224905 -0.59039513   1.04344975  1.3128013839
## [134,]   0.55148575 -0.59039513   0.76021149  0.3944526477
## [135,]   0.30995914 -1.04925145   1.04344975  0.2632599711
## [136,]   2.24217198 -0.13153881   1.32668801  1.4439940605
## [137,]   0.55148575  0.78617383   1.04344975  1.5751867371
## [138,]   0.67224905  0.09788935   0.98680210  0.7880306775
## [139,]   0.18919584 -0.13153881   0.59026853  0.7880306775
## [140,]   1.27606556  0.09788935   0.93015445  1.1816087073
## [141,]   1.03453895  0.09788935   1.04344975  1.5751867371
## [142,]   1.27606556  0.09788935   0.76021149  1.4439940605
## [143,]  -0.05233076 -0.81982329   0.76021149  0.9192233541
## [144,]   1.15530226  0.32731751   1.21339271  1.4439940605
## [145,]   1.03453895  0.55674567   1.10009740  1.7063794137
## [146,]   1.03453895 -0.13153881   0.81685914  1.4439940605
## [147,]   0.55148575 -1.27867961   0.70356384  0.9192233541
## [148,]   0.79301235 -0.13153881   0.81685914  1.0504160307
## [149,]   0.43072244  0.78617383   0.93015445  1.4439940605
## [150,]   0.06843254 -0.13153881   0.76021149  0.7880306775
```

## 求单个变量和其它变量的相关性


```r
Sepal_Length = iris$Sepal.Length
iris %>% 
  select(where(is.numeric), -Sepal.Length) %>% 
  apply(2, \(vec) cor(vec, Sepal_Length))
```

```
##  Sepal.Width Petal.Length  Petal.Width 
##   -0.1175698    0.8717538    0.8179411
```

但是在多重循环中，最好不要使用apply函数或者显式套用apply函数。比如我们想求变量间两两的相关性，看起来非常乱。


```r
data_num = select(iris, where(is.numeric))
apply(data_num, 2, \(vec1) apply(data_num, 2, \(vec2) cor(vec1, vec2)))
```

```
##              Sepal.Length Sepal.Width Petal.Length Petal.Width
## Sepal.Length    1.0000000  -0.1175698    0.8717538   0.8179411
## Sepal.Width    -0.1175698   1.0000000   -0.4284401  -0.3661259
## Petal.Length    0.8717538  -0.4284401    1.0000000   0.9628654
## Petal.Width     0.8179411  -0.3661259    0.9628654   1.0000000
```

双层嵌套，看起来不是很美观。


```r
result = data.frame(matrix(1:16, nrow = 4))
for (a in 1:ncol(data_num)) {
  for (b in 1:ncol(data_num)) {
    result[a, b] = cor(data_num[[a]], data_num[[b]])
  }
}
result
```

```
##           X1         X2         X3         X4
## 1  1.0000000 -0.1175698  0.8717538  0.8179411
## 2 -0.1175698  1.0000000 -0.4284401 -0.3661259
## 3  0.8717538 -0.4284401  1.0000000  0.9628654
## 4  0.8179411 -0.3661259  0.9628654  1.0000000
```

我们可以结合for循环和apply减少一层嵌套。


```r
result = data.frame(matrix(1:16, nrow = 4))
for (a in 1:ncol(data_num)) {
  result[[a]] = apply(data_num, 2, \(vec) cor(data_num[[a]], vec))
}
result
```

```
##           X1         X2         X3         X4
## 1  1.0000000 -0.1175698  0.8717538  0.8179411
## 2 -0.1175698  1.0000000 -0.4284401 -0.3661259
## 3  0.8717538 -0.4284401  1.0000000  0.9628654
## 4  0.8179411 -0.3661259  0.9628654  1.0000000
```

## 函数式编程

函数式编程是R的另一大特点，也有可能是因R的面向对象太难用了...
简单求个定积分


```r
integrate(\(x) x**3 + x, 0, 1)
```

```
## 0.75 with absolute error < 8.3e-15
```

## 实例和小测验


```r
# data_exp = as_tibble(data_train_merged[1:100, ])
# saveRDS(data_exp, "示例数据.Rds")
data_task = readRDS("./data/示例数据.Rds")
data_task
```

```
## # A tibble: 100 × 14
##    A6    A5    A4    A3    A2    A1    G6    G5    G4    G3    G2    G1   
##    <fct> <fct> <fct> <fct> <fct> <fct> <fct> <fct> <fct> <fct> <fct> <fct>
##  1 R     A     Q     L     S     Q     X     A     X     L     S     X    
##  2 A     A     Q     L     S     Q     A     A     X     L     S     X    
##  3 C     A     Q     L     S     Q     S     A     X     L     S     X    
##  4 D     A     Q     L     S     Q     N     A     X     L     S     X    
##  5 E     A     Q     L     S     Q     X     A     X     L     S     X    
##  6 F     A     Q     L     S     Q     F     A     X     L     S     X    
##  7 G     A     Q     L     S     Q     G     A     X     L     S     X    
##  8 H     A     Q     L     S     Q     S     A     X     L     S     X    
##  9 I     A     Q     L     S     Q     I     A     X     L     S     X    
## 10 K     A     Q     L     S     Q     X     A     X     L     S     X    
## # ℹ 90 more rows
## # ℹ 2 more variables: Activity <dbl>, Selectivity <dbl>
```

```r
generator_1 = function(sample_space, num) {
  
  # 计算类别A中每个种类的构成
  sample_list_1 = sample_space %>% 
    select(matches("A"), -Activity) %>% 
    lapply(\(vec) table(vec)/length(vec))
  
  # 计算类别G中每个种类的构成
  sample_list_2 = sample_space %>% 
    select(matches("G")) %>% 
    lapply(\(vec) table(vec)/length(vec)) 
  
  # 采用递归方法连接字符串
  seq1 = Reduce(paste0, lapply(sample_list_1, \(.x) sample(names(.x), num, T, .x)))
  seq2 = Reduce(paste0, lapply(sample_list_2, \(.x) sample(names(.x), num, T, .x)))
  
  list(Sequence1 = seq1, Sequnce2 = seq2)
  
}

generator_1(data_task, 100)
```

```
## $Sequence1
##   [1] "RAQLQP" "RAQLSQ" "RALLSQ" "RAQLSQ" "RAQLSQ" "RGQLVQ" "MAQLSQ" "LAQLPQ"
##   [9] "RAQLSW" "RAQLPQ" "VAQLSQ" "RRRWSQ" "RAQPSQ" "RAQLSQ" "RAQLQQ" "RAQLSQ"
##  [17] "RAQASQ" "RAAPSQ" "RAWDSQ" "RAQLSQ" "NAQLSV" "RAQLKQ" "HAQLSQ" "RAHLSS"
##  [25] "RAQLYQ" "RAQLSQ" "RMQLSQ" "FAQLSQ" "RAQLSQ" "RAQISQ" "RAQLMA" "AAQLSQ"
##  [33] "RAQLSQ" "RAQLSQ" "RAQGSQ" "RAQLSF" "RAPLLQ" "RAQLSD" "RAQLSQ" "RAVGTQ"
##  [41] "RAQLNQ" "MAQLSE" "RAQLSQ" "RAQLSQ" "RAGLSQ" "RAELSQ" "QAQCSQ" "RAQLVQ"
##  [49] "RAQRSQ" "RAQLGQ" "KAQTTP" "RAHLSQ" "RAQLDQ" "RAQLSC" "KAQHSV" "RAQLRR"
##  [57] "RAELWQ" "RFTLFQ" "RAQLSA" "LAQLSQ" "RRQLSQ" "RAQLSQ" "RAQLGQ" "RFYLRQ"
##  [65] "PAQLEQ" "RAQLSH" "RAQTSQ" "WAQGSQ" "VAQLFQ" "RAQLTQ" "RAQLSQ" "AAQVSQ"
##  [73] "RAQTQL" "RAQESQ" "RAQLSQ" "RAQLSQ" "RAQYSQ" "RAQPSQ" "LAQLSQ" "RAALSQ"
##  [81] "RAQPSQ" "RAQLSQ" "RAQLAQ" "NAQLSQ" "VAQLSQ" "MAQLSF" "RAQLSQ" "RAQLSQ"
##  [89] "RAWLSQ" "RAQLSR" "QAELGQ" "RAQLSQ" "RAQLSQ" "RAQLSV" "RYQLSQ" "WAQLSQ"
##  [97] "RAQLSQ" "RAQLSQ" "RAQLSQ" "RAQLSQ"
## 
## $Sequnce2
##   [1] "XAXLSX" "XAXLFX" "XIXLSX" "XAXXSX" "XAXLSN" "XAXLSX" "GAPLSX" "SAXLSX"
##   [9] "XIXLSX" "XAXLSX" "XAXLSX" "XAXLSX" "SAXLSX" "XSXPSI" "XAXLSX" "XAXLSI"
##  [17] "XAXSPX" "XAXFSX" "XAFLSX" "XAXLLX" "XAXXSG" "XAXLSX" "XFXLSX" "IAXLSX"
##  [25] "XANLSX" "XAXLSF" "XAXLPX" "XASLXX" "XSXLSX" "GAXLAX" "XASFSX" "IAXLSX"
##  [33] "PXXLSX" "FAXLSX" "XAXLSX" "XLXLSX" "XAXLSX" "XANLSX" "XAXLSS" "XAXLSX"
##  [41] "XAXLSX" "SAXLXG" "XAXLSF" "XAFFSX" "LAXLSX" "XAXLSX" "XAXLSX" "XAXLSX"
##  [49] "XAXLNX" "XAXFSX" "SAILSX" "NAPLSX" "XAXLSN" "XAXLXX" "XAXLSX" "XAXLFX"
##  [57] "XAXSSX" "XAXLSX" "XANISX" "XAXLSX" "XAXLSX" "XAXLSA" "XSXLSX" "LAXLFX"
##  [65] "XAXLSL" "XAXLFX" "XAXLSX" "XAXLSX" "XPXLSX" "XAXLSL" "XAXPSX" "XAXLSX"
##  [73] "XAXLSX" "XAXLSX" "XAXLSX" "XAXLSX" "NAXSSX" "XAXLSX" "XAXLSP" "XAXSSX"
##  [81] "XAXGSX" "XAXLSX" "XXXLIX" "XSXLSX" "XAXLSX" "XAXLSX" "IAXLSX" "XAXLSX"
##  [89] "XAXLSX" "XAXLNX" "XASLSX" "XAXLSI" "XAPFSX" "XAXLAX" "SAXLSX" "XAXLSX"
##  [97] "XFXLSS" "XAXGGX" "XAFLSX" "AAXNSX"
```

为什么1能运行2运行不了呢？


```r
generator_2 = function(sample_space, num) {
  
  # 计算类别A中每个种类的构成
  sample_list_1 = sample_space %>% 
    select(matches("A"), -Activity) %>% 
    apply(2, \(vec) table(vec)/length(vec))
  
  # 计算类别G中每个种类的构成
  sample_list_2 = sample_space %>% 
    select(matches("G")) %>% 
    apply(2, \(vec) table(vec)/length(vec)) 
  
  # 采用递归方法连接字符串
  seq1 = Reduce(paste0, lapply(sample_list_1, \(.x) sample(names(.x), num, T, .x)))
  seq2 = Reduce(paste0, lapply(sample_list_2, \(.x) sample(names(.x), num, T, .x)))
  
  list(Sequence1 = seq1, Sequnce2 = seq2)
  
}

generator_2(data_task, 100)
```
